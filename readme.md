# Программа для инклинометров (версия с датчиками давления и новой температурой)

Программа преобразует текстовый файл исходных данных в текстовый файл с колонками:
Time - время;
Vabs - скорость, м/с;
Vdir - направление, °;
v, u - составляющие, м/с;
inclination	- модуль угла наклона, °;
Pressure - давление, дБар;
Temp - температура, °C;
Battery - напряжение батареи, В.

Для каждого инклинометра имеется своя конфигурация со значениями которые может менять пользователь:
- коэффициенты пересчета из кодов АЦП в физические величины:
  - датчика давления с использованием термокомпенсации (по датчику температуры),
  - показаний акселерометра и магнитометра в нормированные единицы с учетом:
    - магнитного склонения,
    - положения прибора (значения акселерометра), соответствующие нулевой скорости течения 
	
## Порядок работы

### Пересчет

1. Поместить исходные данные INKL_P{number}.TXT в каталог _raw, где {number} - число, номер инклинометра для которого будут найдены калибровочные коэффициенты
2. Поместить рядом с каталогом _raw файл run.bat, из примера (С:\Work\DATA\230616_Kulikovo@inclinometer\run.bat)
3. Запустить расчет.
Результирующие текстовые файлы будут помещены рядом в автосозданный каталог text_output
Журнал шагов выполнения программы расположен в С:\Programs\_coding\tcm\incl_h5clc_hy.log

### Ввод коэффициентов для пересчета

Перед расчетом скорости данные акселерометра (и аналогично магнетометра) нормируются. При этом используется формула:
	
	`V = Rz * Ag * (Ug - Ug0)`
где 
Rz: матрица 3x3 вращения,
Ag: матрица 3x3 масштабирования
Ug: двнные 3х каналов инклинометра
Ug0: матрица 3x1 смещения

Коэффициенты задаются в файле коэффициентов, на который указывает параметр запуска программы `input.coefs_path`. Также имеются параметры запуска, которыми можно переопределить эти коэффициенты. Пути к коэффициентам в файле и соответствующие входные параметры (указаны в скобках):
Rz: coef/Rz (input.coefs.Rz)
Ag: coef/G/A (input.coefs.Ag) 
Cg: coef/G/C (input.coefs.Cg)
Ah: coef/H/A (input.coefs.Ah) 
Ch: coef/H/C (input.coefs.Ch)
azimuth_shift_deg: coef/H/azimuth_shift_deg (input.coefs.azimuth_shift_deg) - магнитное склонение + инструментальный сдвиг 180°
kVabs: coef/Vabs0 (input.coefs.kVabs) - коэффициенты пересчета угла наклона инклинометра в модуль скорости
P_t: coef/P_t (input.coefs.P_t) - матрица коэффициентов пересчета показаний датчика давления в отсчетах АЦП с термокомпенсацией в физические величины
	
Файл коэффициентов: С:\Work\coefs.h5, можно редактировать с помощью программы HDFView. Программа уже установлена, ярлык на рабочем столе. После открытия программы файл коэффициентов можно открыть в режиме для редактирования через меню "File" / "Open as" / "File Read/Write" или по кнопке "Resent Files" и затем на открывшемся файле "Reload File As" / "Read/Write". Затем выбрать нужный коэффициент нужного прибора двойным кликом и заменить данные. Например, для датчика давления инклинометра P01 путь к коэффициентам перевода отсчетов АЦП по каналам давления и термокомпенсации: incl_p01/coef/P_t. Это матрица коэффициентов, где первый коэффициент (в верхнем левом углу) соответствует смещению (дБар), т.е. нужно дважды кликнуть на данный элемент матрицы, заменить число, при закрытии окна с данными подтвердить замену.

## Ввод положения прибора соответствующие нулевой скорости течения

По умолчанию положене прибора соответствующее нулевой скорости определяется матрицей поворота Rz в файле коэффициентов. Для ввода своего значения акселерометра соответствующего нулевой скорости служит параметр запуска программы
`input.coef.g0xyz=[{Gx},{Gy},{Gz}]`.
Его можно прописать в файле run.bat в командной строке запуска программы `incl_h5clc_hy.py`. При этом она рассчитает новую матрицу поворота и будет ее использовать вместо Rz.
	

